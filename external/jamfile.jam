# owlcpp/external/jamfile.jam
# part of owlcpp project.
# Distributed under the Boost Software License, Version 1.0; see doc/license.txt.
# Copyright Mikhail K Levin 2010-2

project external ;

if ! $(RAPTOR) { 
   EXIT "
   Please set variable RAPTOR to location and version of expat library.
   See doc/user-config.jam
   " ;
}
using ext/raptor : $(RAPTOR[2]) : $(RAPTOR[1]) ;
alias raptor : /ext/raptor//raptor ;
# alias raptor_pic : /ext/raptor//raptor : <link>static <pic>on ;

if ! $(FACTPP) { 
   EXIT "
   Please set variable FACTPP to location and version of FaCT++ library.
   See doc/user-config.jam
   " ;
}
using ext/factpp : $(FACTPP[2]) : $(FACTPP[1]) ;
alias factpp_kernel 
   : /ext/factpp//factpp_kernel 
   : #<link>static 
;

# libxml2 (not Expat) is used with Raptor because it better handles encodings.
# Building libxml2 requires iconv and libzip.
# On Linux libxml2 is integrated into the system and is expected to be available.
# On Windows, libxml2 is built from source
# On Mac, pre-built libxml2 is currently required.

import modules ;

local os = [ modules.peek : OS ] ;

if $(os) = LINUX {

   LIBXML2_H ?= /usr/include/libxml2 ;
   
   local libxml2_id = <name>xml2 ;
   if $(LIBXML2_DLL) {
      libxml2_id = <file>$(LIBXML2_DLL) ;
   }
   
   lib libxml2 
      : 
      : 
         $(libxml2_id)
#         <link>shared 
      : 
      : <include>$(LIBXML2_H) <library>zlib 
   ;

   lib zlib : : <name>z ;
   
} else if $(os) = NT {

   if ! $(LIBXML2) && ! ( $(LIBXML2_DLL) && $(LIBXML2_LIB) && $(LIBXML2_H) ) { 
      EXIT "
      Please set variable LIBXML2 to location of pre-compiled libxml2 library.
      See doc/user-config.jam
      " ;
   }
   
   using ext/libxml2 : $(LIBXML2[2]) : $(LIBXML2[1]) ;
   alias libxml2 : /ext/libxml2//libxml2 ;
}
